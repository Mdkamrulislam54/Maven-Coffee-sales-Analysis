# Maven-Coffee-sales-Analysis

-- Table

-- Find the top 5 dates with the highest total sales:

SELECT 
TRANSACTION_DATE,
SUM(TRANSACTION_QTY*UNIT_PRICE) AS TOTAL_SALES
FROM TRANSACTIONS
GROUP BY 1
ORDER BY SUM(TRANSACTION_QTY*UNIT_PRICE) DESC
LIMIT 5;

-- Determine peak transaction Time (by quantity):

SELECT
CASE 
	WHEN EXTRACT(HOUR FROM TRANSACTION_TIME) BETWEEN 6 AND 10 THEN 'MORNING'
    WHEN EXTRACT(HOUR FROM TRANSACTION_TIME) BETWEEN 11 AND 16 THEN 'AFTERNOON'
    WHEN EXTRACT(HOUR FROM TRANSACTION_TIME) BETWEEN 17 AND 20 THEN 'EVENING'
    ELSE 'NIGHT'
END AS TIME,
SUM(TRANSACTION_QTY) AS TOTAL_QTY
FROM TRANSACTIONS
GROUP BY TIME
ORDER BY SUM(TRANSACTION_QTY) DESC;
-- LIMIT 1;

-- Get all transactions where unit_price is higher than the average price of its category:

SELECT *
FROM TRANSACTIONS
WHERE UNIT_PRICE >
	(SELECT 
    AVG(UNIT_PRICE) AS AVG
    FROM TRANSACTIONS);
    
-- Rank product types by sales within each category:

SELECT
PRODUCT_CATEGORY,
PRODUCT_TYPE,
SUM(TRANSACTION_QTY*UNIT_PRICE) AS REVENUE,
RANK() OVER(PARTITION BY PRODUCT_CATEGORY ORDER BY SUM(TRANSACTION_QTY*UNIT_PRICE) DESC) AS SALES_RANK
FROM TRANSACTIONS
GROUP BY 1,2;

 -- Find the top-selling product per store by revenue:
 
 WITH CTE AS(
 SELECT 
 STORE_ID,
 PRODUCT_ID,
 SUM(UNIT_PRICE * TRANSACTION_QTY) AS REVENUE,
 RANK() OVER(PARTITION BY STORE_ID ORDER BY SUM(UNIT_PRICE * TRANSACTION_QTY) DESC) AS RANK_REV
 FROM transactions
 GROUP BY STORE_ID, PRODUCT_ID)
 
 SELECT *
 FROM CTE
 WHERE RANK_REV =1;

--  Monthly sales trend by product category:

SELECT
date_format(TRANSACTION_DATE, '%Y-%m') AS MONTH,
PRODUCT_CATEGORY,
SUM(UNIT_PRICE * TRANSACTION_QTY) AS TOTAL_SALES
FROM TRANSACTIONS
GROUP BY MONTH, PRODUCT_CATEGORY
ORDER BY MONTH, PRODUCT_CATEGORY DESC ;

-- List dates where sales increased more than 30% compared to the previous day:

WITH DAILY_SALES AS(
SELECT
TRANSACTION_DATE,
SUM(UNIT_PRICE * TRANSACTION_QTY) AS REVENUE
FROM TRANSACTIONS
GROUP BY TRANSACTION_DATE),

SALES_WITH_LAG AS(
SELECT
TRANSACTION_DATE,
REVENUE,
LAG(REVENUE) OVER(ORDER BY TRANSACTION_DATE) AS PEREVIOUS_DAY_SALES
FROM DAILY_SALES)

SELECT *
FROM SALES_WITH_LAG
WHERE REVENUE > 1.3*PEREVIOUS_DAY_SALES;

-- List dates where sales increased more than 30% compared to the previous day:

WITH DAILY_SALES AS(
SELECT
TRANSACTION_DATE,
SUM(UNIT_PRICE * TRANSACTION_QTY) AS REVENUE
FROM TRANSACTIONS
GROUP BY TRANSACTION_DATE),

SALES_WITH_LAG AS(
SELECT
TRANSACTION_DATE,
REVENUE,
LAG(REVENUE) OVER(ORDER BY TRANSACTION_DATE) AS PEREVIOUS_DAY_SALES
FROM DAILY_SALES)

SELECT *
FROM SALES_WITH_LAG
WHERE REVENUE > 1.3*PEREVIOUS_DAY_SALES;

-- Find the slowest-selling product types (sold at least 5 times but with lowest revenue:

SELECT
PRODUCT_TYPE,
SUM(TRANSACTION_QTY) AS TOTAL_QTY,
SUM(UNIT_PRICE * TRANSACTION_QTY) AS REVENUE
FROM TRANSACTIONS
GROUP BY PRODUCT_TYPE
HAVING SUM(TRANSACTION_QTY) >=5
ORDER BY SUM(UNIT_PRICE * TRANSACTION_QTY) ASC
LIMIT 5;
